<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" 
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Apache Subversion 1.7 Release Notes</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<style type="text/css">
  @import url("/style/site.css");
</style>
</head>

<body>
<!--#include virtual="/site-banner.html" -->
<!--#include virtual="/site-nav.html" -->
<div id="site-content">
<!--#include virtual="/site-notice.html" -->
<!-- **************** BEGIN CONTENT ***************** -->

<h1 style="text-align: center">Apache Subversion 1.7 Release Notes</h1>

<div class="h2" id="news">
<h2>What's New in Apache Subversion 1.7
  <a class="sectionlink" href="#news"
    title="Link to this section">&para;</a>
</h2>

<ul>
  <li><a href="#wc-ng"
      >Working Copy Metadata Storage Improvements</a></li>
  <li><a href="#httpv2"
      >Improved HTTP protocol usage</a></li>
  <li><a href="#svnrdump"
      >New remote dumpfile tool: <tt>svnrdump</tt></a></li>
  <li><a href="#patch"
      >New feature: svn patch</a></li>
  <li><a href="#enhancements"
      >Many enhancements and bug fixes</a></li>
  <li><a href="#issues"
      >Known issues in the release</a></li>
  <li><a href="#distribution-changes"
      >Dependency, license and distribution changes</a></li>
</ul>

<p>Apache Subversion 1.7 is a superset of all previous Subversion
releases, and is as of the time of its release considered the current
"best" release.  Any feature or bugfix in 1.0.x through 1.6.x is also
in 1.7, but 1.7 contains features and bugfixes not present in any
earlier release.  The new features will eventually be documented in a
1.7 version of the free Subversion book
(<a href="http://svnbook.red-bean.com" >svnbook.red-bean.com</a>).</p>

<p>This page describes only major changes.  For a complete list of
changes, see the 1.7 section of the <a
href="http://svn.apache.org/repos/asf/subversion/trunk/CHANGES" >CHANGES</a>
file.</p>

</div>  <!-- news -->

<div class="h2" id="compatibility">
<h2>Compatibility Concerns
  <a class="sectionlink" href="#compatibility"
    title="Link to this section">&para;</a>
</h2>

<p>Older clients and servers interoperate transparently with 1.7
servers and clients.  However, some of the new 1.7 features may not be
available unless both client and server are the latest version.  There are
also cases where a new feature will work but will run less efficiently if
the client is new and the server old.</p>

<p>There is <strong>no need</strong> to dump and reload your
repositories.  Subversion 1.7 servers can read and write to repositories created by
earlier versions.  To upgrade an existing server installation, just install the
newest libraries and binaries on top of the older ones.</p>

<p>Subversion 1.7 servers use the same repository format as Subversion 1.6.
Therefore, it is possible to seamlessly upgrade and downgrade between 1.6.x and 1.7.x
servers without changing the format of the on-disk repositories.
(This is not correct in general for any pair of 1.x and 1.y servers,
but happens to hold for 1.6 and 1.7.)
If new 1.7 features were enabled on the server (in the hooks or server
configuration files), they will, of course, have to be disabled prior
to reverting back to a 1.6 server.</p>

<p>Subversion 1.7 clients use a new working copy format.
Subversion 1.7 clients cannot use Subversion 1.6 (and earlier) working copies.
Existing working copies created with Subversion 1.6 and earlier need to be
upgraded before they can be used with a Subversion 1.7
client (see <a href="#wc-ng">below</a> for details).</p>

<p>Subversion 1.7 maintains API/ABI compatibility with earlier
releases, by only adding new functions, never removing old ones.  A
program written to any previous 1.x API can both compile
and run using 1.7 libraries.  However, a program written for 1.7
cannot necessarily compile or run against older libraries.</p>

<p>There may be limited cases where the behavior of old APIs has been
slightly modified from previous releases.  These are cases where edge cases
of the functionality has been deemed buggy, and therefore improved or removed.
Please consult the
<a href="http://svn.apache.org/repos/asf/subversion/trunk/notes/api-errata/1.7/"
>API errata</a> for more detailed information on what these APIs are
and what impact these changes may have.  For Subversion 1.7, these
errata are mostly limited to <code>libsvn_wc</code>, with one notable
exception: <code>libsvn_ra_serf</code>'s approach to driving
the <code>svn_delta_editor_t</code> interfaces (provided to it indirectly
via calls to the <code>svn_ra.h</code> interfaces).</p>

<div class="h3" id="new-feature-compatibility-table">
<h3>New Feature Compatibility Table
  <a class="sectionlink" href="#new-feature-compatibility-table"
    title="Link to this section">&para;</a>
</h3>
<table border="1">
  <tr>
    <th>New Feature</th>
    <th>Minimum Client<sup>1</sup></th>
    <th>Minimum Server</th>
    <th>Minimum Repository</th>
    <th>Notes</th></tr>
  <tr>
    <td><a href="#httpv2">HTTPv2</a></td>
    <td>1.7</td>
    <td>1.7</td>
    <td>any</td>
    <td>Permutations of older client/server combinations will continue to
      function at the pre-1.7 feature level. Server-side configuration
      changes might be required for optimal performance with clients that
      use <a href="#serf">serf</a>.</td></tr>
  <tr>
    <td><a href="#wc-ng">WC-NG</a></td>
    <td>1.7</td>
    <td>any</td>
    <td>any</td>
    <td>1.6 working copies cannot be used with 1.7 and will
        <strong>not</strong> be upgraded to the new 1.7 format
        automatically.</td></tr>
  <tr>
    <td><a href="#svnrdump">svnrdump</a></td>
    <td>1.7</td>
    <td>1.4&nbsp;(dump)<br />1.7&nbsp;(load)</td>
    <td>any</td>
    <td>See <a href="#svnrdump">the full entry, below</a> for discussion
        of known issues.</td></tr>
  <tr>
    <td><a href="#patch">svn patch</a></td>
    <td>1.7</td>
    <td>any</td>
    <td>any</td>
    <td></td></tr>
  <tr>
    <td><a href="#atomic-revprops">atomic revprop changes</a></td>
    <td>1.7</td>
    <td>1.7</td>
    <td>any</td>
    <td>Fixes a race condition in <tt>svnsync</tt> (<a
        href="http://subversion.tigris.org/issues/show_bug.cgi?id=3546"
        >issue #3546</a>).</td></tr>
  <tr>
    <td><a href="#subtree-mergeinfo-recording">reduced subtree mergeinfo 
      recording</a></td>
    <td>1.7</td>
    <td>any</td>
    <td>any</td>
    <td>If both pre-1.7 clients and 1.7 clients are used to perform merges 
      to the same branch, the pre-1.7 clients may experience slower merge 
      performance.</td></tr>
  <tr>
    <td><a href="#server-performance-tuning">server performance tuning</a></td>
    <td>any</td>
    <td>1.7</td>
    <td>any</td>
    <td>Purely server-side configuration. file:// access in 1.7 clients will
      use the default settings.</td></tr>
   <tr>
     <td colspan="5"><sup>1</sup>Reminder: when using the <tt>file://</tt>
       repository access method, the Subversion program is both the client
       <em>and</em> the server.</td></tr>
</table>

</div>  <!-- new-feature-compatibility-table -->

<div class="h3" id="output-changes">
<h3>Command Line Output Changes
  <a class="sectionlink" href="#output-changes"
    title="Link to this section">&para;</a>
</h3>

<p>Although we try hard to keep output from the command line programs
compatible between releases, new information sometimes has to be
added.  This can break scripts that rely on the exact format of the
output.  For this reason, we encourage programs which consume the output
of the commandline client to consider using the <tt>--xml</tt> option,
or accessing Subversion through the various bindings interfaces.</p>

<!-- Insert items here, of the following form:
<div class="h4" id="foo">
<h4>Improved output of <tt>svn foo</tt>
  <a class="sectionlink" href="#foo"
    title="Link to this section">&para;</a>
</h4>

<p>The output of <tt>svn foo</tt> has been improved.  The following
example illustrates these changes.</p>

<pre>
   $ svn foo
   BAR
   BAZ
   BLAH
   BIN
   $ 
</pre>

</div>
-->

<div class="h4" id="multi-update">
<h4>Improved output of <tt>svn update</tt> for multiple working copies
  <a class="sectionlink" href="#multi-update"
    title="Link to this section">&para;</a>
</h4>

<p>Improvements have been made to the output of <tt>svn update</tt>
when updating multiple working copies at once (see
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3693"
  >issue #3693</a>). Below is an example of the new output:</p>

<pre>
  $ svn up subversion svncorp UNVERSIONED
  Updating 'subversion':
  At revision 1037740.
  Updating 'svncorp':
  At revision 288.
  Skipped 'UNVERSIONED'
  Summary of updates:
   Updated 'subversion' to r1037740.
   Updated 'svncorp' to r288.
  Summary of conflicts:
   Skipped paths: 1
</pre>

</div> <!-- multi-update -->

<div class="h4" id="diff-properties">
<h4><tt>svn diff</tt> now shows property changes as unidiff
  <a class="sectionlink" href="#diff-properties"
    title="Link to this section">&para;</a>
</h4>

<p><tt>svn diff</tt> now shows textual property changes in unidiff format,
except for <tt>svn:mergeinfo</tt> properties.
Below is an example of the new output:</p>

<pre>
  $ svn diff
  Index: gamma
  ===================================================================
  --- gamma       (revision 23)
  +++ gamma       (working copy)

  Property changes on: gamma
  ___________________________________________________________________
  Modified: svn:externals
  ## -1,3 +1,3 ##
   ^/branches/gamma gamma-external
  -^/trunk/alpha alpha-external
  +^/trunk/beta beta-external
   ^/trunk/epsilon epsilon-external
  Index: beta
  ===================================================================
  --- beta        (revision 23)
  +++ beta        (working copy)

  Property changes on: beta
  ___________________________________________________________________
  Added: svn:eol-style
  ## -0,0 +1 ##
  +native
</pre>

</div> <!-- diff-properties -->

<div class="h4" id="error-numbers">
<h4>Error and warning numbers now reported
  <a class="sectionlink" href="#error-numbers"
    title="Link to this section">&para;</a>
</h4>

<p>The output of <tt>svn</tt> now contains an error number or warning
number with every error.  The following example illustrates these changes.</p>

<pre>
   % svn info
   svn: E155007: '/home/CIA-91' is not a working copy
</pre>

<p>These error values are useful as search keywords.  Under the hood, these error
codes correspond to the <a href="/docs/api/latest/svn__error__codes_8h_source.html"
>API error codes</a> used by Subversion and APR.  For programming to our API's,
it's possible to convert a numeric error code to a symbolic one via the <a
href="https://svn.apache.org/repos/asf/subversion/tools/client-side/which-error.py"
>which-error.py</a> script (first included in Subversion 1.3.0):</p>

<pre>
   % ./tools/dev/which-error.py 155007
   00155007  SVN_ERR_WC_NOT_DIRECTORY
</pre>

</div>
</div>  <!-- output-changes -->

<div class="h3" id="compat-misc">
<h3>Miscellaneous Compatibility Notes
  <a class="sectionlink" href="#compat-misc"
    title="Link to this section">&para;</a>
</h3>

<p>There are some additional specific areas where changes made in this
release might necessitate further adjustment by administrators or
users.  We'll cover those in this section.</p>

<div class="h4" id="case-sensitive-authz">
<h4>Case sensitivity of authz access rules
  <a class="sectionlink" href="#case-sensitive-authz"
    title="Link to this section">&para;</a>
</h4>

<p>Prior to this release, the section headers in Subversion's authz
access files&mdash;which contain repository names and repository
filesystem paths&mdash;were parsed in a case-insensitive fashion.
That's been fixed in this release.  The practical fallout, though, is
that your existing authz files might be depending (perhaps
unintentionally) on the old behavior and the new behavior could result
in access to items in your repositories being unexpectedly
denied&mdash;or granted&mdash;as a result of upgrading to Subversion
1.7.  Please review all authz access files for case correctness.  (For
details,
see <a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3781"
>issue #3781</a>).</p>

</div>  <!-- case-sensitive-authz -->

<div class="h4" id="revprop-packing">
<h4>Incompatible FSFS changes since 1.7.0-alpha3 for packed repositories
  <a class="sectionlink" href="#revprop-packing"
    title="Link to this section">&para;</a>
</h4>

<p>Subversion 1.6 introduced support for <a href="1.6.html#fsfs-packing">packing
  FSFS revision files</a>, and Subversion 1.7.x alpha releases (up to
1.7.0-alpha3) supported packing of revprops into an SQLite database.  This
support is not present in the final release (see <a
href="http://subversion.tigris.org/issues/show_bug.cgi?id=3952"
>issue #3952</a> for the reason).  Any
FSFS-backed repositories that were <tt>svnadmin create</tt>d or
<tt>svnadmin upgrade</tt>d by <tt>svnadmin</tt> from a nightly build or
from an alpha release of the 1.7.x line are <strong>not</strong> supported by
the final 1.7.0 release.  It is required to <tt>dump</tt> these repositories
using an <tt>svnadmin</tt> built from the 1.7.0-alpha3 release (or to
<tt>svnsync</tt> them using a source server running 1.7.0-alpha3) in order to
upgrade them for the 1.7.0 release.</p>

<p>Subversion 1.7 will complain when it encounters such repositories, with
the following error:</p>

<pre>
subversion/libsvn_fs_fs/fs_fs.c:1083: (apr_err=160043)
svnadmin: E160043: Found format '5', only created by unreleased dev builds;
   see <a href="http://subversion.apache.org/docs/release-notes/1.7#revprop-packing">http://subversion.apache.org/docs/release-notes/1.7#revprop-packing</a>
</pre>

<p>We reiterate that this lack of upgrade path is within the latitude of
our <a href="/prerelease-caveats">policy for pre-releases</a>.  We may
provide in the future a script to downgrade a repository in-place to the
format supported by both 1.6 and 1.7.  (We will welcome <a href="/contributing"
>contributions</a> of such a script.)</p>

<p>We plan to reintroduce revprop packing in a future release; see <a
href="http://subversion.tigris.org/issues/show_bug.cgi?id=3944"
>issue #3944</a> for details.</p>

</div>  <!-- revprop-packing -->

<div class="h4" id="immediate-dir-removal">
<h4>'svn remove' now removes directories from disk immediately
  <a class="sectionlink" href="#immediate-dir-removal"
    title="Link to this section">&para;</a>
</h4>

<p>The <tt>svn remove</tt> command now removes directories from disk
immmediately. In Subversion 1.6, directories were scheduled for deletion
but kept on disk to retain meta-data stored in the <tt>.svn</tt> subdirectory.
With the new working copy format introduced in Subversion 1.7 it is no
longer necessary to keep the removed directory on disk. This also
facilitates better handling of directory replacements in the working
copy (see <a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3468"
>issue #3468</a> for details).</p>

<p>If the <tt>--keep-local</tt> option is used, <tt>svn remove</tt> will
keep the removed directory on disk.</p>

</div>  <!-- immediate-dir-removal -->

<div class="h4" id="large-dir-caching">
<h4>Large versioned directories in FSFS repositories
  <a class="sectionlink" href="#immediate-dir-removal"
    title="Link to this section">&para;</a>
</h4>

<p>Subversion 1.7 introduces a new data cache implementation. In contrast to
version 1.6, we now limit the size of that cache to give better control over
the total amount of memory consumed by the server process. On the flip side,
it also limits the size of directories that can be cached and, therefore
handled, efficiently. If you version directories with more than 10,000 entries,
you must change the cache settings (see 
<a href="#server-performance-tuning">server performance tuning</a>
for details).</p>

</div>  <!-- large-dir-caching -->

</div>  <!-- compat-misc -->

</div>  <!-- compatibility -->

<div class="h2" id="new-features">
<h2>New Features
  <a class="sectionlink" href="#new-features"
    title="Link to this section">&para;</a>
</h2>

<div class="h3" id="wc-ng">
<h3>Working Copy Metadata Storage Improvements (<em>client</em>)
  <a class="sectionlink" href="#wc-ng"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7 features a complete re-write of the working copy
metadata management system of Subversion, code named WC-NG.  The old system
was one of the first parts of Subversion written, and over time had grown
difficult to maintain and extend.  WC-NG is intended to provide an
immediate performance improvement, while also enabling many future feature 
enhancements.</p>

<p>Although Subversion 1.7 does not introduce these new features, the
improvements in the working copy storage make them much more likely to
appear in future releases.</p>

<p>A number of known (and unknown) bugs have been fixed by the new working
copy metadata system (see
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3357">issue
#3357</a>).</p>

<div class="h4" id="single-db"> 
<h4>Centralized Metadata Storage
  <a class="sectionlink" href="#single-db"
    title="Link to this section">&para;</a> 
</h4>

<p>A key feature of the changes introduced in Subversion 1.7 is the
centralization of working copy metadata storage into a single location.
Instead of a <tt>.svn</tt> directory in every directory in the working
copy, Subversion 1.7 working copies have just one <tt>.svn</tt>
directory&mdash;in the root of the working copy.  This directory includes
(among other things) an SQLite-backed database which contains all of the
metadata Subversion needs for that working copy.</p>

<p>Even though the data is stored in a structured format, the relationships
between the data are complex.  We highly discourage external tools from
modifying the data held in this database, as such modification is likely to
result in working copy corruption.</p>

<p></p>

<div class="notice"><span style="color: red"><b>WARNING:</b></span> It is not
  safe to copy an SQLite file while it's being accessed via the SQLite
  libraries.  Consequently, duplicating a working copy (using <tt>tar</tt>,
  <tt>cp</tt>, or <tt>rsync</tt>) that is being accessed by a Subversion
  process is not supported for Subversion&nbsp;1.7 working copies, and may
  cause the duplicate (new) working copy to be created corrupted. (See <a
    href="http://subversion.tigris.org/issues/show_bug.cgi?id=3596"
  >issue #3596</a> for details.)</div>


</div>  <!-- single-db -->

<div class="h4" id="wc-pristines"> 
<h4>Pristine Contents
  <a class="sectionlink" href="#wc-pristines"
    title="Link to this section">&para;</a> 
</h4>

<p>Subversion keeps a record of the unmodified contents of all files in the
working copy.  Historically, these have been called <em>text-bases</em>, but
in Subversion 1.7, they have received a new name, and a new home.  With the
centralization of metadata, the text-bases have been renamed
<em>pristines</em>, and are now located in the same <tt>.svn</tt>
directory as the working copy metadata.</p>

<p>The pristines are stored by checksum in a sharded format.  Any files
in the working copy which have the same pristine content will now share
references to the pristine store, making such working copies slightly
smaller.  Running <tt>svn cleanup</tt> will remove any pristines which
are no longer needed by the current state of the working copy.</p>

<p><strong>Note:</strong> In 1.7, we recommend to run <tt>svn cleanup</tt>
periodically in order to reclaim
the disk space of unreferenced pristines.  We expect a future Subversion
release to purge unreferenced (and thus unused) pristines automatically; see
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=4071">issue #4071</a>
for details.</p>

</div>  <!-- wc-pristines -->

<div class="h4" id="wc-upgrade"> 
<h4>Upgrading the Working Copy
  <a class="sectionlink" href="#wc-upgrade"
    title="Link to this section">&para;</a> 
</h4>

<p>Subversion 1.7 introduces substantial changes to the working copy format.
In previous releases of Subversion, Subversion would automatically update
the working copy to the new format when a write operation was performed.
Subversion 1.7, however, will make this a manual step.  Before using
Subversion 1.7 with their working copies, users will be required
to run a new command, <tt>svn upgrade</tt> to update the metadata to the
new format.  This command may take a while, and for some users, it may be more
practical to simply checkout a new working copy.</p>

<p><strong>Note:</strong> Subversion 1.7 cannot upgrade working copies that
a 1.6 client would have refused to operate upon before an <tt>svn cleanup</tt>
was run (with a 1.6 client).  In other words, before upgrading to 1.7, a 1.6
client must be used to run <tt>svn cleanup</tt> on all working copies that
require cleanup.  Likewise, Subversion 1.7 cannot upgrade corrupt 1.6 working
copies. Unfixable problems can arise from missing or corrupt meta-data inside
<tt>.svn</tt> directories.  Such damage to the 1.6 working copy is permanent,
and cannot be fixed even if <tt>svn cleanup</tt> is run prior to the upgrade.</p>
<p>We regret these limitations, but we had to introduce them in order for
1.7 to ship timely and without overcomplicating the internals.
If your working copy does not upgrade cleanly, please check out a new one.</p>

<!-- 'sed -ne 5p < .svn/entries' to print `svn info | grep URL` of a 1.4-1.6 working copy. -->

</div>  <!-- wc-upgrade -->

</div>  <!-- wc-ng -->

<div class="h3" id="httpv2">
<h3>Improved HTTP protocol usage (<em>client</em> and <em>server</em>)
  <a class="sectionlink" href="#httpv2"
    title="Link to this section">&para;</a>
</h3>

<p>Over the years, many people have complained about the performance issues
with Subversion's use of HTTP as a repository access mechanism.  This largely
stems from the developers' original intent to implement as much of the WebDAV
<a href="http://www.webdav.org/deltav/">DeltaV</a> specification as
possible.  Alas, this specification was not widely implemented, so
none of the supposed benefits of the DeltaV overhead ever
materialized.</p>

<p>Subversion 1.7 offers a simpler HTTP protocol variant that can be used when
connecting to supported servers.  This simpler protocol (sometimes referred to
as <em>HTTPv2</em>) requires fewer client-server round trips to establish a
connection, making Subversion much more performant on high-latency network
connections.  Subversion's Serf-based repository access library (which will
<a href="#serf">become the default</a> library for HTTP in Subversion 1.8) has received
all of the protocol changes scheduled for 1.7, affecting both commit and read
operations; the older Neon-based library has received the most important and
high-impact of these changes, too.</p>

<p>As mentioned in the <a href="#new-feature-compatibility-table">compatibility
table</a>, Subversion 1.7 will only use HTTPv2 when connecting with a 1.7 (or
greater) server, but will continue to use existing protocols when communicating
with earlier versions of Subversion.  Likewise, older clients will only use the
old protocol when connecting to a Subversion server, regardless of version.</p>

</div>  <!-- httpv2 -->

<div class="h3" id="svnrdump">
<h3>New remote dumpfile tool: <tt>svnrdump</tt> (<em>client</em>)
  <a class="sectionlink" href="#svnrdump"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7 adds a new tool to the client's toolbox:
<tt>svnrdump</tt>.  <tt>svnrdump</tt> replicates the functionality of
<tt>svnadmin dump</tt> and <tt>svnadmin load</tt>, but works on
remote repositories, instead of needing administrator (local filesystem) access
to the source or target repository.</p>

<div class="h4" id="svnrdump-race">
<h4><tt>svnrdump load</tt> race condition
  <a class="sectionlink" href="#svnrdump-race"
    title="Link to this section">&para;</a>
</h4>

<p>Note that <tt>svnrdump load</tt> can suffer from a race condition
in its locking algorithm when run against a 1.6 or earlier server.
The race condition is only applicable if multiple <tt>svnrdump load</tt>
processes may attempt to write concurrently to a single repository.
This is the same problem that the new <a href="#atomic-revprops"
>atomic revprop changes feature</a> fixes for
<tt>svnsync</tt> (see <a
href="http://subversion.tigris.org/issues/show_bug.cgi?id=3546"
 >issue #3546</a>), and the same <a href="#atomic-revprops">server-side
workaround</a> is available.</p>

<p>Server administrators who would like to block their users
from committing via <tt>svnrdump load</tt> may do so by installing the
following <tt>pre-revprop-change</tt> script:</p>

<pre>
#!/bin/sh
PROPNAME="$4"
if [ "$PROPNAME" = "svn:rdump-lock" ]; then
  echo "'svnrdump load' disabled by the server administrator" &gt;&amp;2
  exit 1
fi
exit 0
</pre>

<p>This hook script suffices to protect repositories from <em>accidental</em> use
of <tt>svnrdump load</tt>.  It does not (and cannot) protect the server from 
users who intentionally recompile <tt>svnrdump</tt> in order to bypass this
restriction.</p>

</div>  <!-- svnrdump-race -->

<div class="h4" id="svnrdump-editor">
<h4><tt>svnrdump dump</tt> and <tt>libsvn_ra_serf</tt> editor driving don't mix
  <a class="sectionlink" href="#svnrdump-editor"
    title="Link to this section">&para;</a>
</h4>

<p>The <tt>svnrdump dump</tt> command is more strict in its expectations
from the network access library than
<a href="/docs/api/latest/svn__ra_8h.html?svn_ra_replay_range#a9fbcde06ba0b9ddb331631852f3277bd"
>the API</a> permits it to be.  This problem manifests itself in particular
with the <a href="#serf">ra_serf HTTP access library</a>, as documented
in <a href="http://subversion.tigris.org/issues/show_bug.cgi?id=4116"
>issue #4116</a>.  A workaround is to
<a href="http://svnbook.red-bean.com/en/1.7/svn.advanced.confarea.html#svn.advanced.confarea.opts.servers"
>use the ra_neon HTTP access library</a> (which is the default).</p>

<p>The problem does not affect other executables (such as <tt>svn</tt> and
<tt>svnadmin</tt>).  It also does not affect <tt>svnrdump</tt> when the default
HTTP access library, ra_neon, is used.  Third-party API consumers should not
expect to be able to use all the orderings permitted by the
<a href="/docs/api/latest/structsvn__delta__editor__t.html">delta editor API</a>
when the editor receiver is <tt>svnrdump dump</tt>.</p>

<p>This problem is related to, but not the same as,
<a href="https://svn.apache.org/repos/asf/subversion/trunk/notes/api-errata/1.7/ra001.txt"
>ra_serf's dishonouring of the delta editor ordering rules</a>.</p>

</div>  <!-- svnrdump-editor -->

</div>  <!-- svnrdump -->

<div class="h3" id="patch">
<h3>New feature: <tt>svn patch</tt> (<em>client</em>)
  <a class="sectionlink" href="#patch"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7 features a new subcommand called <tt>svn patch</tt>
which can apply patch files in unidiff format (as produced by
<tt>svn diff</tt> and other diff tools) to a working copy.</p>

<p><tt>svn patch</tt> will apply unidiff changes to existing files just
like third party patch tools.
It will also add newly created files to version control, and delete files
and directories which are left empty after patching.
Keywords and newlines are also handled automatically if the
<tt>svn:keywords</tt> and <tt>svn:eol-style</tt> properties are
set on patched files.</p>

<p><tt>svn diff</tt> will now produce unidiff output for Subversion
property changes, and <tt>svn patch</tt> is able to apply these changes
to properties (except for <tt>svn:mergeinfo</tt>, see
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3747"
  >issue #3747</a>).</p>

<p>When a patch does not apply cleanly some or all changes listed in the
patch might be rejected. But <tt>svn patch</tt> currently does not
mark files with rejected changes as conflicted (see
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3565"
  >issue #3565</a>). Files which weren't patched successfully can be
committed without being touched by <tt>svn resolve</tt> first.
This problem will be addressed in a future release of Subversion.</p>

<p>A new API for parsing unidiff patch files has been added to
<code>libsvn_diff</code>. A new API for applying unidiff patches to a
working copy has been added to <code>libsvn_client</code>.</p>

</div>  <!-- patch -->


</div>  <!-- new-features -->

<div class="h2" id="enhancements">
<h2>Enhancements and Bugfixes
  <a class="sectionlink" href="#enhancements"
    title="Link to this section">&para;</a>
</h2>

<!-- Don't need to highlight every bugfix, just major ones which aren't in
     any patch release. -->

<div class="h3" id="cmdline">
<h3>Command-line client improvements (<em>client</em>)
  <a class="sectionlink" href="#cmdline"
    title="Link to this section">&para;</a>
</h3>

<p>There are far too many enhancements and new options to the
command-line client to list them all here.  Aside from all the ones
mentioned already in these release notes, below are a few more that we
consider important, but please see the 1.7.0 section in the <a
href="http://svn.apache.org/repos/asf/subversion/trunk/CHANGES">CHANGES</a> file
for a complete list.</p>

<!-- Insert selected items here -->

<div class="h4" id="log-diff">
<h4>svn log can now print diffs
  <a class="sectionlink" href="#log-diff"
    title="Link to this section">&para;</a>
</h4>
<p><tt>svn log</tt> accepts the new <strong><tt>--diff</tt></strong>
option which causes it to show changes committed in a revision as
a unified diff. Below is example output:</p>
<pre>
  $ svn log --diff -r1033146 http://svn.apache.org/repos/asf/subversion/trunk
  ------------------------------------------------------------------------
  r1033146 | hwright | 2010-11-09 19:40:46 +0100 (Tue, 09 Nov 2010) | 3 lines

  * subversion/libsvn_wc/wc_db.c
    (svn_wc__db_op_copy): Remove unused variable.


  Index: subversion/libsvn_wc/wc_db.c
  ===================================================================
  --- subversion/libsvn_wc/wc_db.c	(revision 1033145)
  +++ subversion/libsvn_wc/wc_db.c	(revision 1033146)
  @@ -3061,7 +3061,7 @@ svn_wc__db_op_copy(svn_wc__db_t *db,
                      apr_pool_t *scratch_pool)
   {
     svn_wc__db_pdh_t *src_pdh, *dst_pdh;
  -  const char *src_relpath, *dst_relpath, *dst_op_root_relpath;
  +  const char *src_relpath, *dst_relpath;
     apr_int64_t dst_op_depth;
   
     SVN_ERR_ASSERT(svn_dirent_is_absolute(src_abspath));

  ------------------------------------------------------------------------
</pre>

</div>  <!-- log-diff -->

<div class="h4" id="update-parents">
<h4>svn update now accepts the --parents option
  <a class="sectionlink" href="#update-parents"
    title="Link to this section">&para;</a>
</h4>
<p><tt>svn update</tt> now accepts the <strong><tt>--parents</tt></strong>
option. This option removes the need to manually create missing parent
directories when adding additional items to a sparse working copy.</p>

<p>For example, adding 3 files from different directories to a sparse
working copy required creating each file's parent directories first:</p>
<pre>
   $ svn co --depth=empty ${PROJECT_ROOT_URL} wc
   $ svn up --depth=empty wc/A wc/A/D wc/A/D/G wc/A/D/H wc/A/B wc/A/B/E
   $ svn up wc/A/D/G/pi wc/A/D/H/omega wc/A/B/E/alpha
</pre>
<p>This becomes much easier with the new --parents option:</p>
<pre>
   $ svn co --depth=empty ${PROJECT_ROOT_URL} wc
   $ svn up --parents wc/A/D/G/pi wc/A/D/H/omega wc/A/B/E/alpha
</pre>
</div>  <!-- update-parents -->

<div class="h4" id="svn-relocate">
<h4>New subcommand: svn relocate
  <a class="sectionlink" href="#svn-relocate"
    title="Link to this section">&para;</a>
</h4>
<p>A new <tt>svn relocate</tt> subcommand has been added.
It points a working copy to a different repository root URL, serving
the same purpose as the old <tt>svn switch --relocate</tt> syntax
which has now been deprecated.</p>
</div>  <!-- svn-relocate -->

<div class="h4" id="switch-ancestry-check">
<h4>svn switch now checks ancestry
  <a class="sectionlink" href="#switch-ancestry-check"
    title="Link to this section">&para;</a>
</h4>
<p><tt>svn switch</tt> now checks that the working copy item being
switched shares common version control history with the URL to which
it is being switched.</p>

<p>This change was made to protect users from the unpleasant side
effects of oft-mistyped switch commands, such as accidentally
running <tt>svn switch ^/branches</tt> when you instead meant to
run <tt>svn switch ^/branches/<em>SOME-BRANCH</em></tt>.  As of
version 1.7, Subversion will check to see if the source URL and the
target working copy item are ancestrally related and, if they do not,
the switch operation will fail with an error.</p>

<pre>
   $ svn switch ^/branches
   svn: E195012: Path '.' does not share common version control ancestry
   with the requested switch location.  Use --ignore-ancestry to disable
   this check.
   $
</pre>

<p>What is meant by "ancestrally related"?  In short, it means that if
you were to compare all the paths and revisions that each of these two
version controlled items has occupied over time &mdash; its current
repository location plus all previous ones, back through all the
copies and moves in its history &mdash; those two sets would
overlap.</p>

<p>As noted in the previous example's error message, this ancestry
check &mdash; which does come at some performance cost &mdash; may be
disabled by passing the <strong><tt>--ignore-ancestry</tt></strong>
option to the <tt>svn switch</tt> command.</p>
</div>  <!-- switch-ancestry-check -->

<div class="h4" id="diff-show-copies-as-adds">
<h4>svn diff can show copied files as if they were newly added
  <a class="sectionlink" href="#diff-show-copies-as-adds"
    title="Link to this section">&para;</a>
</h4>
<p>When <tt>svn diff</tt> shows a copied file, it usually shows how the
copied file differs from the file it was copied from.
Sometimes this isn't the desired form of output. There are situations where
a copied file needs to appear in its entirety, for instance when producing
a patch file to be applied elsewhere with a patch tool (such as
<a href="#patch"><tt>svn patch</tt></a>).</p>

<p>In Subversion 1.7, <tt>svn diff</tt> takes a new
<strong><tt>--show-copies-as-adds</tt></strong> option which causes copied
files to be shown in their entirety, just like newly added files are shown.</p>

</div>  <!-- diff-show-copies-as-adds -->

<div class="h4" id="diff-git">
<h4>svn diff can show git-style diff annotations
  <a class="sectionlink" href="#diff-git"
    title="Link to this section">&para;</a>
</h4>
<p><tt>svn diff</tt> takes a new
<strong><tt>--git</tt></strong> option which causes it to produce extra
annotations denoting added, deleted, and copied files.
This extended diff format was inspired by
<a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff.html"
>git-diff</a>.</p>

<p><tt>svn diff --git</tt> is intended to produce patches which are
compatible to
<a href="http://www.kernel.org/pub/software/scm/git/docs/git-apply.html"
>git-apply</a>, but there are limitations due to differences between
Subversion and git:
<ul>
  <li><tt>svn diff</tt> currently cannot display rename information.
      Renames are always shown as a copy and a delete.</li>
  <li>All paths in patches are shown relative to the repository root to
      avoid ambiguity. It is possible that the numbers of leading path
      components on the left and right side of the patch differ,
      for instance if a diff between <tt>/trunk</tt> and
      <tt>/branches/mybranch</tt> is shown.
      This may prevent git-apply from applying such patches without
      modification.</li>
</ul>
</p>

<p>In a future release of Subversion,
<a href="#patch"><tt>svn patch</tt></a> will receive support for the
extra annotations produced by <tt>svn diff --git</tt>, so that additions,
copies, renames, and deletions can be handled explicitly rather than
implicitly.</p>

<p>The same diff format extensions are also supported by
<a href="http://mercurial.selenic.com">Mercurial</a>.</p>

</div>  <!-- diff-git -->

<div class="h4" id="svn-help-merge">
<h4>svn merge help text has been enhanced
  <a class="sectionlink" href="#svn-help-merge"
    title="Link to this section">&para;</a>
</h4>
<p>The help text for the <tt>svn merge</tt> command has been enhanced.
It now explains common use cases and includes small examples, making it
more useful for quick reference.</p>
</div>  <!-- svn-help-merge -->

<div class="h4" id="svnlook-filesize">
<h4>New subcommand: svnlook filesize
  <a class="sectionlink" href="#svnlook-filesize"
    title="Link to this section">&para;</a>
</h4>
<p>A new <tt>svnlook filesize</tt> subcommand has been added.
It returns the size of a given path in the repository, for
a given revision or transaction. This is a constant-time operation
regardless of the size of the file. In pre-commit hooks wanting to
block commits with too large files, <tt>svnlook filesize</tt> can now
be used instead of the much more costly workaround via
<tt>svnlook cat</tt>.</p>
</div>  <!-- svnlook-filesize -->


</div>  <!-- cmdline -->

<div class="h3" id="apis">
<h3>API changes, improvements and language bindings
    (<em>client and server</em>)
  <a class="sectionlink" href="#apis"
    title="Link to this section">&para;</a>
</h3>

<p>There are too many new and revised APIs in Subversion 1.7.0 to list
them all here.  See the <a
href="http://subversion.apache.org/docs/api/1.7/" >Subversion API
Documentation</a> page for general API information.  If you develop a
3rd-party client application that uses Subversion APIs, you should
probably look at the header files for the interfaces you use and see
what's changed.</p>

<p>As noted <a href="#compatibility">above</a>, a small number of APIs in
<code>libsvn_wc</code> have slightly changed functionality from their
historical roots.  Each of these cases has been documented as an
<a href="http://svn.apache.org/repos/asf/subversion/trunk/notes/api-errata/1.7/">errata</a>,
detailing the impact of these changes.  All of the errata were the result of
behavior which was deemed buggy, and the API changes are an attempt to fix
these bugs.  The circumstances under which each is triggered are relatively
rare, and we anticipate the actual impact to end users will be minimal.</p>

<p>Language bindings have mostly been updated for the new APIs, though
some may lag more than others.</p>

<div class="h4" id="javahl">
<h4>JavaHL Updates
  <a class="sectionlink" href="#javahl"
    title="Link to this section">&para;</a>
</h4>

<p>Due to the move to the Apache Software Foundation, the JavaHL bindings
have been similarly moved to a new package: <code>org.apache.subversion</code>.
The old package still exists, and will continue to ship for backward
compatibility reasons, but we recommend comsumers switch to the new package,
as only it will continue to be updated.</p>

<p>Also, JavaHL now requires Java 1.5 to compile.  In addition, many of the APIs
in the new package have been switch to use generics, and other Java 1.5
language features.</p>

</div>  <!-- javahl -->

</div>  <!-- apis -->

<div class="h3" id="bug-fixes">
<h3>Bug fixes (<em>client and server</em>)
  <a class="sectionlink" href="#bug-fixes"
    title="Link to this section">&para;</a>
</h3>

<p>A great many bugs have been fixed.  See the 1.7.0 section in the <a
href="http://svn.apache.org/repos/asf/subversion/trunk/CHANGES">CHANGES</a> file
for details.</p>

</div>  <!-- bug-fixes -->

<div class="h3" id="serf">
<h3>Serf HTTP library improved and stabilized (<em>client</em>)
  <a class="sectionlink" href="#serf"
    title="Link to this section">&para;</a>
</h3>

<p>The <code>libsvn_ra_serf</code> repository access library has received
a lot of improvements and stabilization.
The design of <a href="http://code.google.com/p/serf/">serf</a> facilitates
future performance improvements that are impossible to achieve with
<a href="http://www.webdav.org/neon/">neon</a>. There were plans to make
serf the default HTTP access library for the 1.7 release.
But because of some remaining issues (for instance
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3979"
  >issue #3979</a>,
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3980"
  >issue #3980</a>, and
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3981"
  >issue #3981</a>),
Subversion 1.7 still uses neon by default.
Remaining problems are mostly due to insufficient infrastructure deployed
in the wild wild web, such as HTTP proxies that do not support HTTP/1.1.
Workarounds for these problems will be implemented for the next release.
serf will become the default HTTP access library in Subversion 1.8.
</p>
<p>
In the meantime, we encourage all users to try serf with Subversion 1.7 and
<a href="/docs/community-guide/issues.html#reporting-bugs"
>report any problems</a>. Successful test reports are appreciated as well.
Tests in networks that use HTTP proxies or enterprise authentication are
particularly helpful.
You can configure which library the client should use on a default or
host-by-host basis by setting the <tt>http-library</tt> variable in the
client-side <tt>servers</tt> configuration file
(<tt>~/.subversion/servers</tt>).</p>

<div class="notice">
<p>Note that 
<a href="http://svn.haxx.se/dev/archive-2011-01/0320.shtml"
>server-side configuration changes</a> might be required to avoid
performance regressions for serf clients in some setups.</p>
<p>The <strong>MaxKeepAliveRequests</strong> option in <tt>httpd.conf</tt>
needs to be increased from 100 (the default) to <b>at least</b> 1000
(there is no reason why it could not be 10000).
This will improve performance by allowing serf clients to use fewer
TCP connections to the server.
Clients using neon will also work fine with this configuration.</p>
</div>

<p>Because serf clients issue a larger number of HTTP GET requests
than neon clients it is possible that serf clients cause quicker
growth of httpd server logs than neon clients do. As of 1.7.3, 
the httpd error logs may also grow more rapidly with serf clients
than with neon clients; see
<a href="http://svn.apache.org/viewvc?rev=1239697&amp;view=rev"
>r1239697</a>.</p>

<p>Known issues with svnrdump that manifest when the latter uses
the ra_serf library for HTTP access are <a href="#svnrdump"
>documented under the 'svnrdump' section</a> of this document.</p>

</div>  <!-- serf -->

<div class="h3" id="http-redirects">
<h3>Improved handling of HTTP redirects (<em>client</em>)
  <a class="sectionlink" href="#http-redirects"
    title="Link to this section">&para;</a>
</h3>

<p>In the past, when the Subversion client encountered an HTTP redirect
response from the server, it displayed an obtuse, and rarely-useful error
message.  Subversion 1.7 improves the situation by following permanent
redirects (<tt>301 Moved Permanently</tt>) for <tt>svn update</tt> and <tt>svn
info</tt>, and providing a more useful error message on temporary
redirects (<tt>302 Found</tt> and <tt>307 Temporary Redirect</tt>).</p>

</div>  <!-- http-redirects -->

<div class="h3" id="atomic-revprops">
<h3>Atomic revprop changes (<em>client</em> and <em>server</em>)
  <a class="sectionlink" href="#atomic-revprops"
    title="Link to this section">&para;</a>
</h3>

<p>Revprop changes are now handled atomically.
This fixes a known race condition in the locking algorithm used by
<tt>svnsync</tt> (see <a
href="http://subversion.tigris.org/issues/show_bug.cgi?id=3546"
 >issue #3546</a>).  It is possible to fix the svnsync race condition
even for pre-1.7 svnsync clients by installing the pre-revprop-change hook
script given in
<a href="http://subversion.tigris.org/issues/show_bug.cgi?id=3546#desc12"
 >comment 12 of issue #3546</a>.  (The hook script requires a 1.7 or newer
<em>server</em> for correctness.)</p>

</div>  <!-- atomic-revprops -->

<div class="h3" id="merge-tracking-enhancements">
<h3>Merge-Tracking Enhancements
  <a class="sectionlink" href="#merge-tracking-enhancements"
    title="Link to this section">&para;</a>
</h3>

<p>While there are scores of bug fixes, performance improvements, and other
changes to merge-tracking, the following are the major changes.  See the
1.7.0 section in the <a
href="http://svn.apache.org/repos/asf/subversion/trunk/CHANGES">CHANGES</a>
file for a complete list.</p>

<div class="h4" id="subtree-mergeinfo-recording">
<h4>Reduced subtree mergeinfo changes
  <a class="sectionlink" href="#subtree-mergeinfo-recording"
    title="Link to this section">&para;</a>
</h4>

<p>Merges no longer record mergeinfo (describing the merge) on subtrees (that
have their own explicit mergeinfo), if the subtree was unaffected by the merge.
This should greatly reduce the number of spurious <tt>svn:mergeinfo</tt>
property changes for users who have large numbers of subtrees with explicit
mergeinfo.</p>

<p>If a change being merged contains svn:mergeinfo modifications these
will still be applied, just like any other property modifications.
So if the change being merged was itself the result of another merge
performed with a 1.5 or 1.6 client, excessive subtree mergeinfo changes
are still possible. Best results will be achieved for new branches
created and maintained exclusively with 1.7 clients.</p>
 
</div>  <!-- subtree-mergeinfo-recording -->

<div class="h4" id="reintegrate-merges">
<h4>Reintegrate merges are less restrictive
  <a class="sectionlink" href="#reintegrate-merges"
    title="Link to this section">&para;</a>
</h4>

<p>Reintegrate merges now succeed in the case where all the prior 'sync'
merges were done as subtree merges, but effectively all the changes were
merged from the target to the source.  Reintegrate also works with shallow
targets, as long as none of the excluded subtrees are affected by the
merge.</p>
 
</div>  <!-- reintegrate-merges -->

<div class="h4" id="merge-notifications">
<h4>Improved notification about mergeinfo changes
  <a class="sectionlink" href="#merge-notifications"
    title="Link to this section">&para;</a>
</h4>

<p>Merge-tracking aware merges now produce special notifications and headers
when a merge records mergeinfo describing a merge or elides mergeinfo.  This
clearly differentiates between changes that are made due to application of a
diff from the merge source and those that are simply merge-tracking
'housekeeping' changes.</p>

<p>Below is an example of the new output, showing notifications about
application of a diff to the file <tt>lib/src/psi.c</tt> and mergeinfo
changes resulting from this merge.</p>

<pre>
   $ svn merge ^/trunk -c3 --depth infinity
   --- Merging r3 into 'lib':
   U    lib/src/psi.c
   --- Recording mergeinfo for merge of r3 into '.':
    U   .
   --- Recording mergeinfo for merge of r3 into 'lib':
    G   lib
   --- Eliding mergeinfo from 'lib':
    U   lib 
</pre>
 
</div>  <!-- merge-notifications -->

<div class="h4" id="merge-mixed-rev-wc">
<h4>Merges into mixed-revision working copies now disallowed by default
  <a class="sectionlink" href="#merge-mixed-rev-wc"
    title="Link to this section">&para;</a>
</h4>

<p>To prevent unnecessary conflicts, <tt>svn merge</tt> will now fail
with an error if the merge target is a
<a href="http://svnbook.red-bean.com/nightly/en/svn.basic.in-action.html#svn.basic.in-action.mixedrevs"
 >mixed-revision working copy</a>.</p>

<p>A mixed-revision working copy will need to be updated with
<tt>svn update</tt> before a merge can be performed into it.
This restriction has always existed during merges using the
<strong><tt>--reintegrate</tt></strong> option and it is now the default
behaviour for every type of merge.</p>

<p>For backwards-compatibility, there is a new option called
<strong><tt>--allow-mixed-revisions</tt></strong> which disables the
check for a mixed-revision working copy, except for reintegrate merges.
Using this option is <strong>not</strong> recommended.
Please use <tt>svn update</tt> instead.</p>

</div>  <!-- merge-mixed-rev-wc -->

<div class="h4" id="svn-mergeinfo-enhancements">
<h4>The mergeinfo subcommand accounts for subtree and partial merges
  <a class="sectionlink" href="#svn-mergeinfo-enhancements"
    title="Link to this section">&para;</a>
</h4>

<p>The <tt>svn mergeinfo</tt> subcommand now flags revisions wich are
partially merged to a target with the <tt>'*'</tt> decorator.  A revision
may be partially merged due to non-inheritable mergeinfo on the target or
because of explicit mergeinfo on some subtree of the target.  The latter case
is ignored by default, but may be considered by using the new <tt>--depth
</tt> and <tt>-R</tt> options for <tt>svn mergeinfo</tt>.</p>
 
</div>  <!-- svn-mergeinfo-enhancements -->

<div class="h4" id="svn-merge-record-only">
<h4>Transitive record only merges
  <a class="sectionlink" href="#svn-merge-record-only"
    title="Link to this section">&para;</a>
</h4>

<p>Merges performed with the <tt>--record-only</tt> option now apply
<tt>svn:mergeinfo</tt> diffs from the merge source.</p>
 
</div>  <!-- svn-merge-record-only -->

<div class="h4" id="svn-merge-sparse-no-tree-conflict">
<h4>Merges into sparse directories no longer cause tree conflicts
  <a class="sectionlink" href="#svn-merge-sparse-no-tree-conflict"
    title="Link to this section">&para;</a>
</h4>

<p>Merges into shallow working copies used to cause tree conflicts on nodes
which were affected by the merge but not present in the working copy.
In 1.7, no tree conflict is flagged. Instead, non-inheritable subtree mergeinfo
is created on the parents of missing nodes, so that later merges into working
copies that are not sparse will pick up any missing changes for those nodes.</p>
 
</div>  <!-- svn-merge-sparse-no-tree-conflicts -->

</div>  <!-- merge-tracking-enhancements -->

<div class="h3" id="server-performance-tuning">
<h3>Server-side performance tuning
  <a class="sectionlink" href="#server-performance-tuning"
    title="Link to this section">&para;</a>
</h3>

<p>Previous releases of Subversion already supported various caching
mechanism like memcached. In version 1.7, the servers will aggressively
cache data in-process to maximize performance. To mitigate the network
throughput as the next potential bottleneck in the chain, the data
compression rate can be configured as well.</p>
 
<div class="h4" id="data-caches">
<h4>Data caching
  <a class="sectionlink" href="#data-caches"
    title="Link to this section">&para;</a>
</h4>

<p>Per default, Subversion server processes will use a 16 MB memory
block to cache file and folder content. This amount is being allocated
by every server process. If you want to increase the cache size, the
maximum cache memory available per process can roughly be estimated as
</p>

<pre>
cache limit = 0.8 * (RAM size / max. server process count) - 4 MB
</pre>
 
<p>Another reasonable upper limit to that in-process cache size is the size
of the active data set. This is usually the size of user files in /trunk
plus the size of all differing files on active branches. So, for the
whole server, two or three times the sum of file sizes of all /trunks
in active repositories on that server is a good indication for a
performance-optimal cache size.</p>

<div class="notice"><span style="color: red"><b>WARNING:</b></span>
	<p>If one of your repositories contains a folder with more than
	10,000 entries (not counting files and folders in sub-trees),
	you <b>must</b> increase the cache size.</p>
   <p>Failure to do so may result in severe performance degradation
	while working on that folder. 64 MByte will be enough to handle
	25,000 entries per folder. For each time that number gets doubled,
	the required cache size quadruples. I.e. 4 GByte will be good for
	about 200,000 entries per folder.</p>
   <p>Reverting to 1.6-style caching (by setting the cache size to 0)
   will reduce overall performance and may cause your server process
   memory to grow	unpredictably. However, it may help when the above
   limits are not	feasible. 30,000 entries will result in about 
   64 MByte of dynamically allocated memory and about 512 MByte for
   250,000 when using 1.6-style caching.</p>
</div>

<p><tt>svnserve</tt> introduces a new optional <tt>--memory-cache-size</tt> 
/ <tt>-M</tt> command line parameter to override the default cache 
size. Using <tt>--cache-fulltexts</tt> and <tt>--cache-txdeltas</tt>
you may instruct the server what kind of data should be cached. The first
should always be enabled unless data is only read once as during a
<tt>svnrdump</tt> run. Text delta caching should be enabled unless
your server memory is low.</p>

<p>For <tt>mod_dav_svn</tt>, a 10 GB cache configuration with maximum
data coverage looks like this in <tt>httpd.conf</tt></p>

<pre>
&lt;IfModule dav_svn_module&gt;
    SVNInMemoryCacheSize 10485760
    SVNCacheFullTexts on
    SVNCacheTextDeltas on
&lt;/IfModule&gt;
</pre>

<p>As a side-effect, the memory consumption becomes more predictable
in many usage scenarios since there is less need to gather and pre-process
data. Please note that a cache size of <tt>0</tt> will deactivate the
new caching facilities and cause the server to fall back to 1.6 caching
mechanisms.</p>
 
</div>  <!-- data-caches -->

<div class="h4" id="compression-level">
<h4>Network data compression level
  <a class="sectionlink" href="#compression-level"
    title="Link to this section">&para;</a>
</h4>

<p>Subversion servers are often disk or network I/O limited. With the
introduction of <a href="#data-caches">data caching</a>, however, disk
I/O can be widely eliminated and the CPU load created by data
compression will become a bottleneck on fast network connections.</p>

<p>The default setting will allow for 10 to 15 MB/s net data throughput
(5 MB to 10 MB compressed data) per client and per CPU core. On a 
multi-core server with a 1 Gb network connection or if clients are mainly 
connected with very limited bandwidth, you may want to select a higher 
compression rate to squeeze a little more data through the network at 
the expense of significantly higher server CPU loads. If the server's NIC 
is not a bottleneck, you may consider lowering the compression level to 
<tt>1</tt> or <tt>2</tt> for 100 Mb clients and to <tt>0</tt> 
(compression off) for a network with predominately 1 Gb clients.</p>

<p>To that end, <tt>svnserve</tt> accepts the new optional 
<tt>--compression</tt> or <tt>-c</tt> command line parameter.
<tt>mod_dav_svn</tt> supports the feature as well but its impact is
limited since over HTTP, network data compression is used only in certain
cases to begin with. The optional module parameter 
<tt>SVNCompressionLevel</tt> controls it:</p>

<pre>
&lt;IfModule dav_svn_module>
    SVNCompressionLevel 9
&lt;/IfModule>
</pre>
 
</div>  <!-- compression level -->

</div>  <!-- server-performance-tuning -->

<div class="h3" id="diff-optimizations">
<h3>Optimizations of diff, merge and blame
  <a class="sectionlink" href="#diff-optimizations"
    title="Link to this section">&para;</a>
</h3>

<p>The svn diff algorithm, which is at the core of <tt>diff</tt>,
<tt>merge</tt> and <tt>blame</tt>, has undergone several optimizations.
For large files which have a lot of identical lines at the beginning
and/or the end, or files which have many lines which are unique to
one side of the comparison, the speedup can be very significant.</p>

</div>  <!-- diff-optimizations -->

<div class="h3" id="libmagic-support">
<h3>Detecting MIME types with libmagic
  <a class="sectionlink" href="#libmagic-support"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7 can optionally be compiled with support for
<a href="http://www.darwinsys.com/file/">libmagic</a> to detect
MIME types of binary files which are added to version control.
This feature is used only for binary files for which no MIME type
is found via auto-props or the mime-types-file configuration option.</p>

</div>  <!-- libmagic-support -->

<div class="h3" id="per-repos-authz">
<h3>Per repository authz file (mod_dav_svn)
  <a class="sectionlink" href="#per-repos-authz"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7 allows using AuthzSVNReposRelativeAccessFile (mutually
exclusive with AuthzSVNAccessFile) to allow specifying a per repository
access file for mod_dav_svn. This makes server installations with many
repositories easier to manage. The path is relative from the conf/
subdirectory in the repository.</p>

</div>  <!-- per-repos-authz -->


<div class="h3" id="windows-case-change">
<h3>Changing case of file and directory names on Windows
  <a class="sectionlink" href="#windows-case-change"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion on Windows now fully supports changing the case of
file and directory names. No more special
<a href="/faq.html#case-change">workarounds</a>, a simple 
'svn mv file.java File.java' just does the right thing.</p>

</div>  <!-- windows-case-change -->

<div class="h3" id="httpd-2.4-support">
<h3>HTTPD 2.4 Support
  <a class="sectionlink" href="#httpd-2.4-support"
    title="Link to this section">&para;</a>
</h3>

<p>Subversion 1.7.5 is the first release that supports httpd
2.4. Since httpd 2.2 and httpd 2.4 are binary incompatible Subversion
must be built to use one or the other. The processor/threading
behaviour in httpd is controlled by the multi-processing-module or
MPM.  In 2.2 the MPM is fixed when httpd is built, in 2.4 the MPM can
be dynamically loaded like other modules.  On Unix-like systems the
default MPM in 2.2 is the worker MPM and in 2.4 the event MPM (binary
distributions may choose other defaults). The event MPM is
incompatible with Subversion's BDB backend so mod_dav_svn will refuse
to open BDB repositories, and log an error, when using the event MPM.</p>

</div>  <!-- httpd-2.4-support -->

</div>  <!-- enhancements -->

<div class="h2" id="issues">
<h2>Known issues in the release
  <a class="sectionlink" href="#issues"
    title="Link to this section">&para;</a>
</h2>

<p>There are some known issues in the Subversion 1.7 releases.  These
may be fixed in later 1.7.x releases.</p>

<div class="h3" id="rhel-2-issue">
<h3>64-bit RHEL2
  <a class="sectionlink" href="#rhel-2-issue"
    title="Link to this section">&para;</a>
</h3>

<p>Building Subversion 1.7.0 and APR 1.4.5 from source on 64-bit RHEL2
with the standard compiler will produce executables that SEGV on
startup.  This problem is likely to affect all 64-bit x86 platforms
that use gcc 4.0.x or older and is due to APR bug
<a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=51851">51851</a>.
Workarounds include using a more recent gcc or configuring APR
with <tt>--disable-nonportable-atomics</tt>.</p>

</div>  <!-- rhel-2-issue -->

<div class="h3" id="osx-107-issue">
<h3>OS X 10.7
  <a class="sectionlink" href="#osx-107-issue"
    title="Link to this section">&para;</a>
</h3>

<p>The SQLite shipped with OS X 10.7 will produce executables that fail at
runtime with the error:</p>
<pre>svn: E200030: Could not initialize SQLite shared cache</pre>
<p>A fix for this problem will be included in the 1.7.1 release.</p>

</div>  <!--osx-107-issue -->

<div class="h3" id="javahl-issue">
<h3>JavaHL SEGV during GC 
  <a class="sectionlink" href="#javahl-issue"
    title="Link to this section">&para;</a>
</h3>

<p>The JavaHL bindings have moved to the org.apache.subversion package
with org.tigris.subversion provided as a compatibility layer.  Using
the compatibility package will cause the JVM to SEGV when SVNAdmin or
SVNClient objects are finalized. A fix for this problem will be included
in the 1.7.1 release.</p>

</div>  <!-- javahl-issue -->

<div class="h3" id="apr-146-issue">
<h3>APR 1.4.6
  <a class="sectionlink" href="#apr-146-issue"
    title="Link to this section">&para;</a>
</h3>

<p>When Subversion is built with APR 1.4.6 some of the Subversion
regression tests will FAIL at random due to a change in the APR hash
table implementation. The APR change causes some Subversion output to
appear in a different order and the testsuite will FAIL when it
expects the old order; the regression tests for the Subversion
bindings may also FAIL. This is a bug in the testsuite and does not
indicate a failure in Subversion.  A fix for the main regression tests
will be included in the 1.7.4 release.</p>

</div>  <!-- apr-146-issue -->

<div class="h3" id="prop-test-35-issue">
<h3>prop_tests.py 35 FAIL
  <a class="sectionlink" href="#prop-test-35-issue"
    title="Link to this section">&para;</a>
</h3>

<p>The regression tests may report a fail for prop_tests.py 35:</p>
<pre>FAIL:  prop_tests.py 35: pg of large text properties redirects properly</pre>
<p>This happens when the user running the regression tests has a
configuration directory (typically $HOME/.subversion) that causes the
Subversion 1.7 command line client to fail.  A fix for this problem has 
been included in the 1.7.7 release.</p>

</div>  <!-- prop-test-35-issue -->

<div class="h3" id="mod_dontdothat-issue">
<h3>mod_dontdothat Compile Error 
  <a class="sectionlink" href="#mod_dontdothat-issue"
    title="Link to this section">&para;</a>
</h3>

<p>Building Subversion 1.7.6 without Apache installed will still
attempt to build the Apache module <tt>mod_dontodothat</tt> and the
compilation will fail due to missing header files such
as <tt>httpd.h</tt>.  To work around this without installing Apache
edit <tt>build-outputs.mk</tt> and change the two
line <tt>mod_dontdothat.la</tt> rule at lines 454 and 455 to the
single line:</p>
<pre>tools/server-side/mod_dontdothat/mod_dontdothat.la:</pre>
<p>1.7.7 restored the build and installation of mod_dontdothat to the same behavior as it was prior to 1.7.6.</p>

</div>  <!-- mod_dontdothat-issue -->

<div class="h3" id="mod_dav_svn-fsmap">
<h3>mod_dav_svn Maps Requests to Local Filesystem
  <a class="sectionlink" href="#mod_dav_svn-fsmap"
    title="Link to this section">&para;</a>
</h3>

<p>Prior to Subversion 1.7.12 all previous versions of <tt>mod_dav_svn</tt>
would allow Apache httpd to map requests handled by <tt>mod_dav_svn</tt> to the
local file system. When this happened httpd would believe that it was serving a
file or directory located at the path that comprises the URI path appended to
the <tt>DocumentRoot</tt> of the server but ending at the first path component
that does not actually exist on the local disk.  For example if your
<tt>DocumentRoot</tt> was <tt>/var/www</tt> and you were accessing
<tt>/svn/repo/README</tt> and <tt>/var/www/svn</tt> did not exist then
httpd would believe it was serving <tt>/var/www/svn</tt>, but if
<tt>/var/www/svn</tt> existed while <tt>/var/www/svn/repo</tt> did not then
it would believe it was serving <tt>/var/www/svn/repo</tt>.  This had several
undesired side effects.</p>

<ul>
  <li><tt>&lt;Directory&gt;</tt> blocks could match requests being served by
    mod_dav_svn.  This would allow directives applied in these configuration
    blocks (most notably access control directives) to be applied.</li>
  <li>When using Apache httpd 2.4.x and <tt>mod_dir</tt>, if a file from the
    <tt>DirectoryIndex</tt> directive existed at the path Apache httpd believed
    it was serving then the request would be rewritten to access that file,
    which may or may not exist.  If the path was the <tt>SVNParentPath</tt>
    then SVN would try to access a repository with the name of the
    <tt>DirectoryIndex</tt> file that was found.</li>
  <li>When using the <tt>%f</tt> variable in your log directives you would log
    the path constructed as described above.  This was confusing since it was
    not the content that was actually served.</li>
</ul>

<p>Starting with Subversion 1.7.12 the requests being served by
<tt>mod_dav_svn</tt> will not be mapped to the local file system and when
logging with the <tt>%f</tt> variable you will see a <tt>&quot;-&quot;</tt> logged.
<tt>&lt;Directory&gt;</tt> blocks will no longer apply to such requests.
Subversion 1.7.14 changed this further and the filename for the request will
now be set as <tt>svn:/path/to/repo/path/in/repo</tt> (e.g. if your repo is at
<tt>/var/svn/repo</tt> and the request is accessing <tt>/trunk/myfile</tt> in
the repo then the filename for the request will be set to 
<tt>svn:/var/svn/repo/trunk/myfile</tt>.  Note that the svn: prefix will
prevent the filename from matching an actual path on disk since it isn't a
valid path and as such <tt>&lt;Directory&gt;</tt> blocks will still not apply.
</p>

<div class="notice">
<p><span style="color: red"><b>WARNING:</b></span>Therefore, if you were
using <tt>&lt;Directory&gt;</tt> blocks to restrict access to paths served
by <tt>mod_dav_svn</tt> you will need to adjust your configuration.  Since
the local filesystem path was not complete this never would have been very
useful for path based authorization, but it could be misused for simple
things like blocking an IP.  These directives must be moved inside the
appropriate <tt>&lt;Location&gt;</tt> blocks.</p>
</div>

<div class="notice">
<p><span style="color: red"><b>WARNING:</b></span>This change may cause checksum
errors with misconfigured httpd servers.  Since 1.7.14 the filename in the
request record now includes the filename in the repository, there have been
cases of mod_mime interfering with Subversion.  Users will see a
<tt>svn: E200014: Checksum mismatch</tt> error when working with files that
end in .gz if a configuration setting like <tt>AddEncoding x-gzip .gz</tt> is
in their configuration file and applies to the locations that Subversion is
being served from.  This happens because the setting now matches on the
Subversion traffic and sets the Content-Encoding header to specify that the
file has been gziped for transmport without changing the file content.  Since
the Subversion client supports gzip content-encoding it decompresses the file
and ends up with the decompressed file which does not match the checksum of the
file it expected.  It is possible that this change may cause other filters to
match Subversion requests that would not have in the past and trigger other
similar errors with other httpd configurations.</p>
</div>

</div> <!-- mod_dav_svn-fsmap -->

</div>  <!-- issues -->

<div class="h2" id="distribution-changes">
<h2>Dependency, license and distribution changes
  <a class="sectionlink" href="#distribution-changes"
    title="Link to this section">&para;</a>
</h2>

<p>Subversion 1.7 marks the first official feature release as part of the
Apache Software Foundation.  A few bits of minutiae have changed as a
result.</p>

<div class="h3" id="deps">
<h3>Subversion Dependency Distribution
  <a class="sectionlink" href="#deps"
    title="Link to this section">&para;</a>
</h3>

<p>Previous releases of Subversion shipped with companion artifacts which
included a number of Subversion dependencies.  In the past, these dependencies
were hard to find and build, and not often installed on the target platform.
Today, this is no longer a problem, so we have discontinued shipping the
companion dependency tarballs.  If you still want to get some of the required
Subversion dependencies before building, you can run the
<tt>get-deps.sh</tt> script in the root of the unpacked archive.</p>

</div>  <!-- deps -->

<div class="h3" id="license">
<h3>License changed to Apache License, version 2
  <a class="sectionlink" href="#license"
    title="Link to this section">&para;</a>
</h3>

<p>Since its inception, Subversion has a used a "modified Apache license".
The migration of the project to the Apache Software Foundation provided
an opprotunity to also change the license to the standard
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License,
version 2.</a>  Additionally, the copyright to the collective work is now
owned by the ASF.  While this has very little practical effect, it does mean
consumers have one less license to worry about when deploying Subversion.</p>

</div>  <!-- license -->

<div class="h3" id="asf-mirrors">
<h3>Download location changes
  <a class="sectionlink" href="#asf-mirrors"
    title="Link to this section">&para;</a>
</h3>

<p>The download location for Subversion <a href="/download">source tarballs</a>
and <a href="/packages">other release artifacts</a>
are now hosted by the Apache Software Foundation.  This includes the official
distribution location, as well as
<a href="http://archive.apache.org/dist/subversion/">archives</a> of all
previous Subversion releases.  Of course, other locations are welcome to
continue to host Subversion distribution artifacts, but the Apache download
sites are now the canonical source for Subversion releases.</p>

</div>  <!-- asf-mirrors -->

<div class="h3" id="contrib">
<h3>No longer shipping <tt>contrib/</tt>
  <a class="sectionlink" href="#contrib"
    title="Link to this section">&para;</a>
</h3>

<p>Since the early days of Subversion development, the Subversion repository
has hosted a section for various other tools and scripts related to
Subversion.  As Subversion has become more popular, the need to host these
tools in the main repository has decreased to the point where we encourage
tool authors to host their contributions at one of a number of external
hosting platforms.  For this reason, and the potentially uncertain nature of
some of the licenses on these scripts, we have stopped shipping the
<tt>contrib/</tt> directory in the release tarballs.  For the time being,
these scripts remain available via the
<a href="http://svn.apache.org/repos/asf/subversion/trunk/contrib/">main
repository</a>.</p>

</div>  <!-- contrib -->

</div>  <!-- distribution-changes -->

<div class="h2" id="svn-1.5-deprecation">
<h2>Subversion 1.5.x series no longer supported
  <a class="sectionlink" href="#svn-1.5-deprecation"
    title="Link to this section">&para;</a>
</h2>

<p>The Subversion 1.5.x line is no longer supported.  This doesn't
mean that your 1.5 installation is doomed; if it works well and is all
you need, that's fine.  "No longer supported" just means we've stopped
accepting bug reports against 1.5.x versions, and will not make any
more 1.5.x bugfix releases.</p>

</div>  <!-- svn-1.5-deprecation -->

<!-- ***************** END CONTENT ****************** -->
</div> <!-- #site-content -->
</body>
</html>
